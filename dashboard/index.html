<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - An√°lisis de Sentimientos</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- WordCloud2.js -->
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>

    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Loader mientras carga el JSON -->
    <div id="loader" class="loader">
        <div class="spinner"></div>
        <p>Cargando an√°lisis...</p>
    </div>

    <!-- Error si no se encuentra el JSON -->
    <div id="error-container" class="error-container" style="display: none;">
        <div class="error-content">
            <h2>‚ö†Ô∏è Error al cargar los datos</h2>
            <p id="error-message"></p>
            <button onclick="location.reload()">Reintentar</button>
        </div>
    </div>

    <!-- Contenedor principal -->
    <div id="dashboard" class="dashboard" style="display: none;">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üìä An√°lisis de Sentimientos</h1>
                <p class="sidebar-subtitle" id="tema-analisis">Cargando...</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#resumen" class="nav-link active" data-section="resumen">
                    <span class="icon">üìä</span>
                    <span>Resumen Ejecutivo</span>
                </a>
                <a href="#interpretacion" class="nav-link" data-section="interpretacion">
                    <span class="icon">ü§ñ</span>
                    <span>Interpretaci√≥n LLM</span>
                </a>
                <a href="#analisis" class="nav-link" data-section="analisis">
                    <span class="icon">üìà</span>
                    <span>An√°lisis Detallado</span>
                </a>
                <a href="#conclusiones" class="nav-link" data-section="conclusiones">
                    <span class="icon">üìã</span>
                    <span>Conclusiones</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="metadata">
                    <p><strong>Total comentarios:</strong> <span id="total-comentarios">-</span></p>
                    <p><strong>Fecha an√°lisis:</strong> <span id="fecha-analisis">-</span></p>
                    <p><strong>Modelo LLM:</strong> <span id="modelo-llm">-</span></p>
                </div>
                <div class="archivo-selector-container">
                    <label for="archivo-selector">
                        <span class="selector-icon">üìÅ</span>
                        Seleccionar An√°lisis
                    </label>
                    <select id="archivo-selector" class="archivo-selector">
                        <!-- Se llena din√°micamente desde JavaScript -->
                    </select>
                </div>
            </div>
        </aside>

        <!-- Contenido principal -->
        <main class="main-content">

            <!-- SECCI√ìN 1: RESUMEN EJECUTIVO -->
            <section id="resumen" class="content-section active">
                <div class="section-header">
                    <h2>üìä Resumen Ejecutivo</h2>
                    <p class="section-description">Visi√≥n general del an√°lisis de sentimientos</p>
                </div>

                <!-- Cards de m√©tricas clave -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">üí¨</div>
                        <div class="metric-content">
                            <h3 id="metric-total">0</h3>
                            <p>Total Comentarios</p>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-content">
                            <h3 id="metric-polaridad">0.00</h3>
                            <p>Polaridad Promedio</p>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üéØ</div>
                        <div class="metric-content">
                            <h3 id="metric-confianza">0%</h3>
                            <p>Confianza Promedio</p>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon" id="metric-sentimiento-icon">üòê</div>
                        <div class="metric-content">
                            <h3 id="metric-sentimiento">Neutral</h3>
                            <p>Sentimiento Predominante</p>
                        </div>
                    </div>
                </div>

                <!-- Gr√°fico 1: Distribuci√≥n de sentimientos (Dona) -->
                <div class="chart-container">
                    <h3>Distribuci√≥n de Sentimientos</h3>
                    <div class="chart-wrapper">
                        <canvas id="chart-distribucion"></canvas>
                    </div>
                </div>
            </section>

            <!-- SECCI√ìN 2: INTERPRETACI√ìN LLM -->
            <section id="interpretacion" class="content-section">
                <div class="section-header">
                    <h2> Interpretaci√≥n del Modelo de Lenguaje</h2>
                    <p class="section-description">An√°lisis cualitativo generado por <span
                            id="llm-model-name">LLM</span></p>
                </div>

                <div class="llm-interpretation">
                    <div class="interpretation-content" id="interpretacion-texto">
                        <p>Cargando interpretaci√≥n...</p>
                    </div>
                </div>

                <!-- Highlights extra√≠dos -->
                <!-- -->
                <div class="highlights-grid" style="display: none;">
                    <div class="highlight-card">
                        <h4>‚ú® Sentimiento Predominante</h4>
                        <p id="highlight-sentimiento">-</p>
                    </div>
                    <div class="highlight-card">
                        <h4>‚úÖ Aspectos Positivos</h4>
                        <p id="highlight-positivos">-</p>
                    </div>
                    <div class="highlight-card">
                        <h4>‚ùå Aspectos Negativos</h4>
                        <p id="highlight-negativos">-</p>
                    </div>
                    <div class="highlight-card">
                        <h4>üîç Patrones Identificados</h4>
                        <p id="highlight-patrones">-</p>
                    </div>
                </div>
            </section>

            <!-- SECCI√ìN 3: AN√ÅLISIS DETALLADO (con pesta√±as) -->
            <section id="analisis" class="content-section">
                <div class="section-header">
                    <h2>üìà An√°lisis Detallado</h2>
                    <p class="section-description">Visualizaciones estad√≠sticas organizadas por categor√≠a</p>
                </div>

                <!-- Pesta√±as de navegaci√≥n -->
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button class="tab-button active" data-tab="polaridad">Polaridad</button>
                        <button class="tab-button" data-tab="frecuencias">Frecuencias</button>
                        <button class="tab-button" data-tab="ngramas">N-gramas</button>
                        <button class="tab-button" data-tab="tfidf">TF-IDF</button>
                        <button class="tab-button" data-tab="emocional">Carga Emocional</button>
                        <button class="tab-button" data-tab="negaciones">Negaciones</button>
                        <button class="tab-button" data-tab="metricas">M√©tricas</button>
                    </div>

                    <!-- TAB 1: POLARIDAD -->
                    <div id="tab-polaridad" class="tab-content active">
                        <!-- Gr√°fico 2: Polaridad por sentimiento (Barras horizontales) -->
                        <div class="chart-container">
                            <h3>Polaridad Promedio por Sentimiento</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-polaridad-sentimiento"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico 3: Distribuci√≥n de polaridad (Histograma) -->
                        <div class="chart-container">
                            <h3>Distribuci√≥n de Polaridad General</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-polaridad-distribucion"></canvas>
                            </div>
                            <p class="chart-note">
                                <strong>Interpretaci√≥n:</strong> Muestra c√≥mo se distribuyen los valores de polaridad
                                (-1 = muy negativo, 0 = neutral, +1 = muy positivo) entre todos los comentarios.
                            </p>
                        </div>

                        <!-- Gr√°fico 4: Rangos de polaridad (Barras con rangos) -->
                        <div class="chart-container">
                            <h3>Rangos de Polaridad por Sentimiento</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-polaridad-rangos"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: FRECUENCIAS -->
                    <div id="tab-frecuencias" class="tab-content">
                        <!-- Gr√°fico 5: WordCloud general -->
                        <div class="chart-container">
                            <h3>Nube de Palabras - General</h3>
                            <div class="wordcloud-wrapper">
                                <canvas id="wordcloud-general" width="800" height="400"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico 6: Top 10 palabras generales -->
                        <div class="chart-container">
                            <h3>Top 10 Palabras M√°s Frecuentes</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-top-palabras"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico 7: Palabras por sentimiento (Barras agrupadas) -->
                        <div class="chart-container">
                            <h3>Palabras M√°s Frecuentes por Sentimiento</h3>
                            <div class="chart-wrapper chart-wrapper-large">
                                <canvas id="chart-palabras-sentimiento"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 3: N-GRAMAS -->
                    <div id="tab-ngramas" class="tab-content">
                        <!-- Gr√°fico 8: Top bigramas generales -->
                        <div class="chart-container">
                            <h3>Top 10 Bigramas M√°s Frecuentes</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-bigramas-general"></canvas>
                            </div>
                            <p class="chart-note">
                                <strong>Bigrama:</strong> Secuencia de dos palabras consecutivas que aparecen juntas
                                frecuentemente.
                            </p>
                        </div>

                        <!-- Gr√°fico 9: Bigramas comparados (negativos vs positivos) -->
                        <div class="chart-container">
                            <h3>Comparaci√≥n de Bigramas: Negativos vs Positivos</h3>
                            <div class="chart-wrapper chart-wrapper-large">
                                <canvas id="chart-bigramas-comparacion"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico 10: Top trigramas negativos -->
                        <div class="chart-container">
                            <h3>Top Trigramas en Comentarios Negativos</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-trigramas-negativos"></canvas>
                            </div>
                            <p class="chart-note">
                                <strong>Trigrama:</strong> Secuencia de tres palabras consecutivas.
                            </p>
                        </div>
                    </div>

                    <!-- TAB 4: TF-IDF -->
                    <div id="tab-tfidf" class="tab-content">
                        <!-- Gr√°fico 11: Heatmap TF-IDF -->
                        <div class="chart-container">
                            <h3>Palabras Distintivas por Sentimiento (TF-IDF)</h3>
                            <div class="chart-wrapper chart-wrapper-large">
                                <canvas id="chart-tfidf-heatmap"></canvas>
                            </div>
                            <p class="chart-note">
                                <strong>TF-IDF:</strong> Identifica palabras que son caracter√≠sticas √∫nicas de cada tipo
                                de sentimiento.
                                Valores m√°s altos indican mayor distintividad.
                            </p>
                        </div>

                        <!-- Gr√°fico 12: Radar de palabras clave -->
                        <div class="chart-container">
                            <h3>Comparaci√≥n de Palabras Clave (Radar)</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-tfidf-radar"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 5: CARGA EMOCIONAL -->
                    <div id="tab-emocional" class="tab-content">
                        <!-- Gr√°fico 13: Distribuci√≥n de emociones (Barras apiladas) -->
                        <div class="chart-container">
                            <h3>Distribuci√≥n de Emociones Detectadas</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-emociones"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico 14: Ratio positivas/negativas (Medidor) -->
                        <div class="chart-container">
                            <h3>Ratio de Palabras con Carga Emocional</h3>
                            <div class="ratio-display">
                                <div class="ratio-bar">
                                    <div class="ratio-positive" id="ratio-positivas"></div>
                                    <div class="ratio-negative" id="ratio-negativas"></div>
                                </div>
                                <div class="ratio-labels">
                                    <span class="label-positive">
                                        <strong id="count-positivas">0</strong> Positivas
                                    </span>
                                    <span class="label-negative">
                                        <strong id="count-negativas">0</strong> Negativas
                                    </span>
                                </div>
                                <p class="ratio-value">
                                    Ratio Negativo/Positivo: <strong id="ratio-value">0.00</strong>
                                </p>
                            </div>
                        </div>

                        <!-- Gr√°fico 15: Top palabras emocionales -->
                        <div class="chart-container">
                            <h3>Palabras con Mayor Carga Emocional</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-palabras-emocionales"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 6: NEGACIONES -->
                    <div id="tab-negaciones" class="tab-content">
                        <!-- Indicador 16: % con negaciones -->
                        <div class="negaciones-summary">
                            <div class="negation-card">
                                <h3 id="negaciones-total">0</h3>
                                <p>Negaciones Totales</p>
                            </div>
                            <div class="negation-card">
                                <h3 id="negaciones-comentarios">0</h3>
                                <p>Comentarios con Negaci√≥n</p>
                            </div>
                            <div class="negation-card highlight">
                                <h3 id="negaciones-porcentaje">0%</h3>
                                <p>Porcentaje del Corpus</p>
                            </div>
                        </div>

                        <!-- Gr√°fico 17: Bigramas con negaci√≥n -->
                        <div class="chart-container">
                            <h3>Bigramas con Negaci√≥n M√°s Frecuentes</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-bigramas-negacion"></canvas>
                            </div>
                        </div>

                        <!-- Lista 18: Palabras m√°s negadas -->
                        <div class="chart-container">
                            <h3>Palabras M√°s Frecuentemente Negadas</h3>
                            <div class="palabras-negadas-list" id="palabras-negadas-list">
                                <!-- Se llena din√°micamente -->
                            </div>
                        </div>
                    </div>

                    <!-- TAB 7: M√âTRICAS -->
                    <div id="tab-metricas" class="tab-content">
                        <!-- Gr√°fico 19: Longitud de comentarios -->
                        <div class="chart-container">
                            <h3>Longitud Promedio de Comentarios por Sentimiento</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-longitud"></canvas>
                            </div>
                            <p class="chart-note">
                                <strong>Observaci√≥n:</strong> La longitud de los comentarios puede indicar el nivel de
                                elaboraci√≥n o intensidad emocional.
                            </p>
                        </div>

                        <!-- Tabla resumen -->
                        <div class="chart-container">
                            <h3>Resumen de M√©tricas por Sentimiento</h3>
                            <table class="metrics-table">
                                <thead>
                                    <tr>
                                        <th>Sentimiento</th>
                                        <th>Cantidad</th>
                                        <th>Porcentaje</th>
                                        <th>Polaridad Promedio</th>
                                        <th>Longitud Promedio</th>
                                    </tr>
                                </thead>
                                <tbody id="metrics-table-body">
                                    <!-- Se llena din√°micamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECCI√ìN 4: CONCLUSIONES -->
            <section id="conclusiones" class="content-section">
                <div class="section-header">
                    <h2>üìã Conclusiones del An√°lisis</h2>
                    <p class="section-description">Resumen de hallazgos principales</p>
                </div>

                <div class="conclusiones-content">
                    <div class="conclusion-block">
                        <h3>üéØ Sentimiento Predominante</h3>
                        <p id="conclusion-sentimiento">-</p>
                    </div>

                    <div class="conclusion-block">
                        <h3>üìä Hallazgos Estad√≠sticos Clave</h3>
                        <ul id="conclusion-estadisticos">
                            <li>Cargando...</li>
                        </ul>
                    </div>

                    <div class="conclusion-block">
                        <h3>üí° Insights Principales</h3>
                        <p id="conclusion-insights">-</p>
                    </div>

                    <div class="conclusion-block">
                        <h3>üîÆ Recomendaciones</h3>
                        <p id="conclusion-recomendaciones">-</p>
                    </div>
                </div>

                <!-- Bot√≥n de descarga del JSON -->
                <div class="actions">
                    <button class="btn-primary" onclick="descargarJSON()">
                        üì• Descargar Datos Completos (JSON)
                    </button>
                </div>
            </section>

        </main>
    </div>

    <!-- Scripts -->
    <script src="main.js"></script>
    <script src="visualizaciones.js"></script>
    <script>
        setInterval(() => {
            fetch('/heartbeat').catch(() => { });
        }, 3000);

        window.addEventListener("beforeunload", () => {
            navigator.sendBeacon('/heartbeat');
        });
    </script>

</body>

</html>